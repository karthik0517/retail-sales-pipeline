resources:
  jobs:
    retail_pipeline_job:
      name: retail_pipeline_job

      schedule:
        quartz_cron_expression: "0 0 2 * * ?"
        timezone_id: "Asia/Kolkata"
        pause_status: "UNPAUSED"

      email_notifications:
        on_failure:
          - karthik90.devops@gmail.com

      tasks:

        - task_key: bronze_task
          max_retries: 2
          min_retry_interval_millis: 30000
          retry_on_timeout: true
          python_wheel_task:
            package_name: retail_pipeline
            entry_point: bronze
            named_parameters:
              catalog: ${var.catalog}
              schema: ${var.schema}
              input_path: /Volumes/app_dev_catalog/bronze/raw_data/orders.csv
          environment_key: default

        - task_key: silver_task
          depends_on:
            - task_key: bronze_task
          max_retries: 2
          min_retry_interval_millis: 30000
          retry_on_timeout: true
          python_wheel_task:
            package_name: retail_pipeline
            entry_point: silver
            named_parameters:
              catalog: ${var.catalog}
              bronze_schema: bronze
              silver_schema: silver
          environment_key: default

        - task_key: gold_task
          depends_on:
            - task_key: silver_task
          max_retries: 2
          min_retry_interval_millis: 30000
          retry_on_timeout: true
          python_wheel_task:
            package_name: retail_pipeline
            entry_point: gold
            named_parameters:
              catalog: ${var.catalog}
              silver_schema: silver
              gold_schema: gold
          environment_key: default

      environments:
        - environment_key: default
          spec:
            client: "1"
            dependencies:
              - ../dist/retail_pipeline-0.1.0-py3-none-any.whl